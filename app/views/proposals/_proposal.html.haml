%li.list-group-item[proposal](style='padding: 0;')
  %ul.list-group(style='margin-bottom: 0;')
    %li.list-group-item.clearfix(style='border: none')
      .col-xs-9
        %p
          - if proposal.best?(:in_favor)
            %span.label.label-warning(style='margin-right: 3px;')
              %i.fa.fa-heart
              베스트
          - if proposal.best?(:opposed)
            %span.label.label-danger(style='margin-right: 3px;')
              %i.fa.fa-ban
              워스트
        %strong
          .clearfix.proposal__body
            %span.label.label-default.pull-left(style='margin-right: 3px;')= proposal.sequential_id
            = smart_body(proposal.body, {data: { toggle: 'preview', stage: "##{dom_id(proposal)} .attachments--image" } })
          = render partial: 'attachments/collection', locals: { attachable: proposal }
        %p.text-muted
          %small
            = user_byline proposal.user
            %i.fa.fa-clock-o
            = date_f proposal.created_at
            - if can? :update, proposal
              = link_to [:edit, proposal] do
                %i.fa.fa-edit
            - if can? :destroy, proposal
              = link_to proposal, method: :delete, data: { confirm: '정말 삭제하시겠습니까?'}  do
                %i.fa.fa-trash
            %button.btn-link
              = render partial: 'attachments/button', locals: { attachable: proposal }
      .col-xs-3
        .text-right
          - if !user_signed_in?
            %button.btn.btn-success.btn-sm.disabled
              %i.fa.fa-heart
              = proposal.votes.by_crews.in_favor.count
          - elsif proposal.in_favor_by?(current_user)
            = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-sm btn-success' do
              %span.change-icon
                %i.fa.fa-heart
                %i.fa.fa-minus-circle
                = proposal.votes.by_crews.in_favor.count
          - else
            = link_to in_favor_proposal_path(proposal), method: :post, class: 'btn btn-sm btn-default' do
              %span.text-default
                %i.fa.fa-heart-o
                = proposal.votes.by_crews.in_favor.count
          - if !user_signed_in?
            %button.btn.btn-danger.disabled
              %i.fa.fa-ban
              = proposal.votes.opposed.count
          - elsif proposal.voted_by?(current_user, :opposed)
            = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-sm btn-danger' do
              %span.change-icon
                %i.fa.fa-ban
                %i.fa.fa-minus-circle
                = proposal.votes.opposed.count
          - else
            = link_to opposed_proposal_path(proposal), method: :post, class: 'btn btn-sm btn-default' do
              %span.text-default
                %i.fa.fa-ban
                = proposal.votes.opposed.count

        .text-right{ style: 'margin-top: 10px;' }
          %span.text-muted(class="#{'disabled' unless proposal.votes.in_favor.any?}" data-toggle="collapse" data-parent="##{dom_id(proposal)}__result" href="##{dom_id(proposal)}__result__in_favor" aria-expanded="false" style="cursor: pointer; text-decoration: underline;")
            투표참가자
            %strong
              = proposal.votes.by_crews.count
            명

  %ul.list-group(style="margin: 0;")
    %li.list-group-item(style='border: none; padding-top: 0; padding-bottom: 0;')
      .panel-group{"id" => "#{dom_id(proposal)}__result", "aria-multiselectable" => "true", :role => "tablist", "style" => "margin: 0"}
        - if proposal.votes.in_favor.any?
          .panel.panel-default{ "style" => "border: none; box-shadow: none; -webkit-box-shadow: none" }
            .panel-collapse.collapse{"id" => "#{dom_id(proposal)}__result__in_favor", :role => "tabpanel"}
              .panel-body
                %hr(style='margin-top:0')
                %strong.text-success
                  %i.fa.fa-heart
                  추천
                .row
                  .col-md-5
                    %i.fa.fa-user
                    선원
                    #{proposal.votes.in_favor.by_crews.count}명
                    (#{number_to_percentage proposal.in_favor_percentage_by_crews, precision: 0})
                  .col-md-7
                    - proposal.votes.in_favor.by_crews.map do |v|
                      @#{v.user.nickname}
                - if proposal.votes.in_favor.by_guests.any?
                  .row
                    .col-md-5
                      %i.fa.fa-user-secret
                      손님
                      #{proposal.votes.in_favor.by_guests.count}명
                    .col-md-7
                      - proposal.votes.in_favor.by_guests.map do |v|
                        @#{v.user.nickname}
        - if proposal.votes.opposed.any?
          .panel.panel-default{ "style" => "border: none; box-shadow: none; -webkit-box-shadow: none" }
            .panel-collapse.collapse{"id" => "#{dom_id(proposal)}__result__opposed", "aria-labelledby" => "headingTwo", :role => "tabpanel"}
              .panel-body
                %hr(style='margin-top:0')
                %h5.text-danger
                  %i.fa.fa-ban
                  차단
                .row
                  .col-md-3
                    %i.fa.fa-user
                    선원
                    #{proposal.votes.opposed.by_crews.count}명
                  .col-md-9
                    - proposal.votes.opposed.by_crews.map do |v|
                      @#{v.user.nickname}
                - if proposal.votes.opposed.by_guests.any?
                  .row
                    .col-md-5
                      %i.fa.fa-user-secret
                      손님
                      #{proposal.votes.opposed.by_guests.count}명
                    .col-md-7
                      - proposal.votes.opposed.by_guests.map do |v|
                        @#{v.user.nickname}

