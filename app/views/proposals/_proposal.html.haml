%li.list-group-item[proposal]
  .row
    .col-xs-9
      %p
        - if proposal.best?(:in_favor)
          %span.label.label-warning(style='margin-right: 3px;')
            %i.fa.fa-heart
            베스트
        - if proposal.best?(:opposed)
          %span.label.label-danger(style='margin-right: 3px;')
            %i.fa.fa-ban
            워스트
      %strong
        .clearfix.proposal__body
          %span.label.label-default.pull-left(style='margin-right: 3px;')= proposal.sequential_id
          = smart_body(proposal.body, {data: { toggle: 'preview', stage: "##{dom_id(proposal)} .attachments--image" } })
        = render partial: 'attachments/collection', locals: { attachable: proposal }
      %p.text-muted
        %small
          = user_byline proposal.user
          %i.fa.fa-clock-o
          = date_f proposal.created_at
          - if can? :update, proposal
            = link_to [:edit, proposal] do
              %i.fa.fa-edit
          - if can? :destroy, proposal
            = link_to proposal, method: :delete, data: { confirm: '정말 삭제하시겠습니까?'}  do
              %i.fa.fa-trash
          %button.btn-link
            = render partial: 'attachments/button', locals: { attachable: proposal }
    .col-xs-3
      .text-right
        - if !user_signed_in?
          %button.btn.btn-success.btn-sm.disabled
            %i.fa.fa-heart
            = proposal.votes.by_crews.in_favor.count
        - elsif proposal.in_favor_by?(current_user)
          = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-sm btn-success' do
            %span.change-icon
              %i.fa.fa-heart
              %i.fa.fa-minus-circle
              = proposal.votes.by_crews.in_favor.count
        - else
          = link_to in_favor_proposal_path(proposal), method: :post, class: 'btn btn-sm btn-default' do
            %span.text-default
              %i.fa.fa-heart-o
              = proposal.votes.by_crews.in_favor.count
        - if !user_signed_in?
          %button.btn.btn-danger.disabled
            %i.fa.fa-ban
            = proposal.votes.opposed.count
        - elsif proposal.voted_by?(current_user, :opposed)
          = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-sm btn-danger' do
            %span.change-icon
              %i.fa.fa-ban
              %i.fa.fa-minus-circle
              = proposal.votes.opposed.count
        - else
          = link_to opposed_proposal_path(proposal), method: :post, class: 'btn btn-sm btn-default' do
            %span.text-default
              %i.fa.fa-ban
              = proposal.votes.opposed.count

      - if proposal.votes.any?
        .text-right{ style: 'margin-top: 10px;' }
          %a.text-muted(data-toggle="collapse" href="##{dom_id(proposal)}__result" aria-expanded="false")
            투표참가자
            %strong
              = proposal.votes.by_crews.count
            명

  .collapse(id="#{dom_id(proposal)}__result")
    %hr
    - if proposal.votes.in_favor.any?
      .result__in_favor(style='margin: 10px 0')
        .row
          .col-xs-12
            %strong.text-success
              %i.fa.fa-heart
              추천
        - if proposal.votes.by_crews.in_favor.any?
          .row
            .col-xs-5
              %i.fa.fa-user
              선원
              #{proposal.votes.by_crews.in_favor.count}명
              (#{number_to_percentage proposal.in_favor_percentage_by_crews, precision: 0})
            .col-xs-7
              - proposal.votes.by_crews.in_favor.map do |v|
                @#{v.user.nickname}
        - if proposal.votes.by_guests.in_favor.any?
          .row
            .col-xs-5
              %i.fa.fa-user-secret
              손님
              #{proposal.votes.by_guests.in_favor.count}명
            .col-xs-7
              - proposal.votes.by_guests.in_favor.map do |v|
                @#{v.user.nickname}
    - if proposal.votes.opposed.any?
      .result__opposed(style='margin: 10px 0')
        .row
          .col-xs-12
            %strong.text-danger
              %i.fa.fa-ban
              차단
        - if proposal.votes.by_crews.opposed.any?
          .row
            .col-xs-5
              %i.fa.fa-user
              선원
              #{proposal.votes.by_crews.opposed.count}명
            .col-xs-7
              - proposal.votes.by_crews.opposed.map do |v|
                @#{v.user.nickname}
        - if proposal.votes.by_guests.opposed.any?
          .row
            .col-xs-5
              %i.fa.fa-user-secret
              손님
              #{proposal.votes.by_guests.opposed.count}명
            .col-xs-7
              - proposal.votes.by_guests.opposed.map do |v|
                @#{v.user.nickname}

