%tr
  %td(style='width: 140px;')
    .text-nowrap(style='margin-bottom: 5px;')
      - if !user_signed_in?
        %button.btn.btn-success.disabled
          %i.fa.fa-thumbs-up
          = proposal.votes.in_favor.count
      - elsif proposal.voted?(current_user, :in_favor)
        = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-success' do
          %span.change-icon
            %i.fa.fa-thumbs-up
            %i.fa.fa-ban
            = proposal.votes.in_favor.count
      - else
        = link_to in_favor_proposal_path(proposal), method: :post, class: 'btn btn-default' do
          %span.text-success
            %i.fa.fa-thumbs-up
            = proposal.votes.in_favor.count
      - if !user_signed_in?
        %button.btn.btn-danger.disabled
          %i.fa.fa-thumbs-down
          = proposal.votes.opposed.count
      - elsif proposal.voted?(current_user, :opposed)
        = link_to unvote_proposal_path(proposal), method: :delete, class: 'btn btn-danger' do
          %span.change-icon
            %i.fa.fa-thumbs-down
            %i.fa.fa-ban
            = proposal.votes.opposed.count
      - else
        = link_to opposed_proposal_path(proposal), method: :post, class: 'btn btn-default' do
          %span.text-danger
            %i.fa.fa-thumbs-down
            = proposal.votes.opposed.count
    - if can? :show_result, proposal
      .text-center
        %a{"data-toggle" => "collapse", :href => "##{dom_id(proposal)}-result"}
          결과보기 >
  %td
    - if proposal.best?
      %p
        %span.label.label-warning
          %i.fa.fa-trophy
          best
    %div
      %strong= proposal.body

    .pull-right
      = user_byline proposal.user
      %i.fa.fa-clock-o
      = date_f proposal.created_at
      - if proposal.user == current_user
        = link_to [:edit, proposal] do
          %i.fa.fa-edit
        = link_to proposal, method: :delete do
          %i.fa.fa-trash
    .clearfix
- if can? :show_result, proposal
  %tr(class="collapse" id="#{dom_id(proposal)}-result")
    %td(colspan=2 style='border-top: 0px; padding: 0px 30px 20px 30px;')
      %hr
      %p
        %i.fa.fa-bar-chart
        결과
      .row
        .col-md-3.text-success
          %i.fa.fa-thumbs-up
          = number_to_percentage proposal.votes.percentage(:in_favor), precision: 0
        .col-md-9
          - proposal.votes.in_favor.map do |v|
            @
            = v.user.nickname
      .row
        .col-md-3.text-danger
          %i.fa.fa-thumbs-down
          = number_to_percentage proposal.votes.percentage(:opposed), precision: 0
        .col-md-9
          - proposal.votes.opposed.map do |v|
            @
            = v.user.nickname
