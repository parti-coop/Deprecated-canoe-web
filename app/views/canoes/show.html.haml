= render 'canoe_header'

.bs-component
  .container
    .panel.panel-default
      .panel-heading
        %h4.text-muted
          %i.fa.fa-flag
          논의
          - if can?(:update, @canoe)
            %small.pull-right
              = link_to new_canoe_discussion_path(@canoe), class: 'btn btn-xs btn-success' do
                %i.fa.fa-edit
                논의 시작하기
      %table.table
        %tbody
          = render @canoe.discussions.order(discussed_at: :desc)

    .panel.panel-default
      .panel-heading
        %h4.text-muted
          %i.fa.fa-users
          선원
          %span.badge= @canoe.crews.count
          - if can?(:accept_crew, @canoe)
            %small.pull-right
              - if @canoe.request_to_joins.any?
                = link_to canoe_request_to_joins_path(@canoe), class: 'btn btn-xs btn-danger' do
                  %i.fa.fa-sign-in
                  승선요청 #{@canoe.request_to_joins.count}명
              - if @canoe.crew?(current_user) and !@canoe.captain?(current_user)
                = link_to canoe_crews_me_path(@canoe), method: :delete,  data: { confirm: '정말 하선하시겠습니까?'}, class: 'btn btn-primary btn-xs' do
                  %i.fa.fa-sign-out
                  하선하기
          - elsif user_signed_in?
            %small.pull-right
              - if @canoe.request_to_join?(current_user)
                %button.btn.btn-xs.btn-danger.disabled
                  %i.fa.fa-sign-in
                  승선요청 중
              - elsif can?(:ask_crew, @canoe)
                = link_to ask_canoe_request_to_joins_path(canoe_id: @canoe), method: :post, class: 'btn btn-xs btn-danger' do
                  %i.fa.fa-sign-in
                  승선요청하기
      .panel-body
        .row
          .col-sm-3.col-xs-4
            .thumbnail.crew
              .crew__image(style="background-image: url(#{@canoe.user.image_url});")
                = @canoe.user.nickname
              .caption
                = @canoe.user.nickname

          - @canoe.crews.exclude_captain.each do |crew|
            .col-sm-3.col-xs-4
              .thumbnail.crew
                .crew__image(style="background-image: url(#{crew.user.image_url});")
                  = crew.user.nickname
                .caption
                  = crew.user.nickname
