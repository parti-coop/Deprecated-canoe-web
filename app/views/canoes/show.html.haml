= render 'canoe_header'

.bs-component
  .container
    .panel.panel-default
      .panel-heading
        %h4.text-muted
          %i.fa.fa-flag
          논의
          - if can?(:update, @canoe)
            %small.pull-right
              = link_to new_canoe_discussion_path(@canoe), class: 'btn btn-xs btn-success' do
                %i.fa.fa-edit
                논의 시작하기
      %ul.list-group
        - @canoe.discussions.order(discussed_at: :desc).each do |discussion|
          = render discussion
    .panel.panel-default
      .panel-heading
        %h4.text-muted
          %i.fa.fa-users
          선원
          %span.badge= @canoe.crews.count
          %small.pull-right
            - if can?(:create, @canoe.invitations.build)
              = link_to canoe_invitations_path(@canoe), class: 'btn btn-xs btn-success' do
                %i.fa.fa-user-plus
                초대하기
            - if can?(:permit_to_join, @canoe) and @canoe.request_to_joins.any?
              = link_to canoe_request_to_joins_path(@canoe), class: 'btn btn-xs btn-success' do
                %i.fa.fa-sign-in
                승선요청
                %span.badge #{@canoe.request_to_joins.count}
            - if @canoe.crew?(current_user) and !@canoe.captain?(current_user)
              = link_to canoe_crews_me_path(@canoe), method: :delete,  data: { confirm: '정말 하선하시겠습니까?'}, class: 'btn btn-primary btn-xs' do
                %i.fa.fa-sign-out
                하선하기
      .panel-body
        .row
          .col-sm-3.col-xs-4
            .thumbnail.crew
              .crew__image(style="background-image: url(#{@canoe.user.image_url});")
                = @canoe.user.nickname
              .caption
                = @canoe.user.nickname

          - @canoe.crews.exclude_captain.each do |crew|
            .col-sm-3.col-xs-4
              .thumbnail.crew
                .crew__image(style="background-image: url(#{crew.user.image_url});")
                  = crew.user.nickname
                .caption
                  = crew.user.nickname
