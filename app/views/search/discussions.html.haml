.bs-component
  .container
    .page-header
      %h3
        %i.fa.fa-search
        = form_tag search_path, method: :get, class: 'form-inline', style: 'display: inline-block' do
          .form-group
            = text_field_tag :q, params[:q], class: 'form-control'
          = submit_tag '찾기', class: 'btn btn-default'
    - if @models_on_current_page.any?
      %h4
        %i.fa.fa-flag
        논의
      .row
        .col-xs-12
          - @models_on_current_page.group_by(&:canoe).each do |canoe, discussions|
            - discussions.each do |discussion|
              .panel.panel-default
                .panel-heading.text-muted
                  %i.fa.fa-cubes
                  = link_to canoe.title, canoe_home_path(canoe)
                %table.table
                  = render discussion
                .panel-footer
                  - opinions_count = discussion.opinions.search_for(params[:q]).count
                  - proposals_count = discussion.proposals.search_for(params[:q]).count
                  - if opinions_count > 0 or proposals_count > 0
                    %tr
                      %td.bg-warning(colspan=2)
                        - opinions_count = discussion.opinions.search_for(params[:q]).count
                        - proposals_count = discussion.proposals.search_for(params[:q]).count

                        - if opinions_count > 0
                          %i.fa.fa-comments
                          의견
                          %strong
                            #{discussion.opinions.search_for(params[:q]).count}건
                        - if opinions_count > 0 and proposals_count > 0
                          과
                        - if proposals_count > 0
                          제안
                          %strong
                            %i.fa.fa-rocket
                            #{discussion.proposals.search_for(params[:q]).count}건이
                        검색되었습니다.
      .row
        .col-xs-12.text-center
          = paginate @models_on_current_page, theme: 'twitter-bootstrap-3'


